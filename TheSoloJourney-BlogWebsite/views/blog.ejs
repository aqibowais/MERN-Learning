<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title><%= blog.title %></title>
    <%- include('./partials/head.ejs') %>
</head>
<body>
    <%- include('./partials/nav.ejs') %>
    
    <div class="container">
        <h1><%= blog.title %></h1>
         <img
          src="<%= `${blog.coverImageUrl}`%>"
          class="card-img-top"
          alt="<%= blog.title %>"
          style="height: 500px; object-fit: contain;"
        />
        <pre class="text-wrap mt-4"><%= blog.body %></pre>
    </div>
    <div class="container mt-3">
        <div class="d-flex align-items-center">
            <% if (blog.createdBy.profileImageUrl) { %>
                <img 
                    src="<%= blog.createdBy.profileImageUrl %>" 
                    class="rounded-circle me-2" 
                    alt="Profile Image" 
                    width="50" 
                    height="50" 
                />
            <% } else { %>
                <div class="rounded-circle bg-secondary me-2 d-flex justify-content-center align-items-center" style="width: 50px; height: 50px;">
                    <span class="text-white"><%= blog.createdBy.fullname.charAt(0) || 'U' %></span>
                </div>
            <% } %>
            <div>
                <p class="mb-0 fw-bold">By: <%= blog.createdBy.fullname || 'Unknown' %></p>
                <small class="text-muted">Published on: <%= new Date(blog.createdAt).toLocaleDateString() %></small>
            </div>
        </div>
    </div>
    
    <!-- comments section -->
    <div class="container mt-5">
        <h3>Comments</h3>
        <form action="/blog/comment/<%= blog.id %>" method="POST">
            <div class="mb-3">
                <label for="content" class="form-label">Add a comment</label>
                <textarea class="form-control" id="content" name="content" rows="3" required placeholder="Write your comment here"></textarea>
            </div>
            <button type="submit" class="btn btn-primary">Submit Comment</button>
        </form>
        
        <% if (locals.comments && locals.comments.length > 0) { %>
            <div class="mt-3">
            <% locals.comments.forEach(comment => { %>
            <div class="card mb-3">
            <div class="card-body">
                <div class="d-flex">
                <div class="me-3">
                <% if (comment.createdBy.profileImageUrl) { %>
                    <img src="<%= comment.createdBy.profileImageUrl %>" 
                     class="rounded-circle" 
                     alt="Profile Image" 
                     width="40" 
                     height="40">
                <% } else { %>
                    <div class="rounded-circle bg-secondary d-flex justify-content-center align-items-center" 
                     style="width: 40px; height: 40px;">
                    <span class="text-white"><%= comment.createdBy.fullname.charAt(0) || 'A' %></span>
                    </div>
                <% } %>
                </div>
                <div class="flex-grow-1">
                <div class="d-flex justify-content-between align-items-center">
                    <strong><%= comment.createdBy.fullname || 'Anonymous' %></strong>
                    <small class="text-muted"><%= new Date(comment.createdAt).toLocaleDateString() %></small>
                </div>
                <p class="mb-1 mt-1"><%= comment.content %></p>
                </div>
                </div>
            </div>
            </div>
            <% }) %>
            </div>
        <% } else { %>
            <div class="alert alert-info mt-3" role="alert">
                No comments yet.
            </div>
        <% } %>
    </div>

    <%- include('./partials/scripts.ejs') %>
</body>
</html>